<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Monkey Emotion Engine</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        .neural-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .emotion-lab {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 800px;
            width: 100%;
        }

        .title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .monkey-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }

        #monkeySvg {
            width: 300px;
            height: 300px;
            cursor: pointer;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #monkeySvg:hover {
            transform: scale(1.05) rotate(2deg);
        }

        .emotion-indicators {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .emotion-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .emotion-dot.active {
            background: #00ff88;
            box-shadow: 0 0 20px #00ff88;
            transform: scale(1.3);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .emotion-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 20px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .emotion-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .emotion-btn:hover:before {
            left: 100%;
        }

        .emotion-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .happy { background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; }
        .sad { background: linear-gradient(135deg, #4682B4, #191970); color: white; }
        .angry { background: linear-gradient(135deg, #FF6347, #DC143C); color: white; }
        .surprised { background: linear-gradient(135deg, #FF69B4, #FF1493); color: white; }
        .sleepy { background: linear-gradient(135deg, #9370DB, #4B0082); color: white; }
        .confused { background: linear-gradient(135deg, #20B2AA, #008B8B); color: white; }
        .excited { background: linear-gradient(135deg, #FF4500, #FF8C00); color: white; }
        .neutral { background: linear-gradient(135deg, #778899, #2F4F4F); color: white; }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #00ff88;
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Advanced SVG Animations */
        .mouth-path {
            transition: d 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .eye {
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }

        .eyebrow {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }

        .nostril {
            transition: all 0.5s ease-in-out;
        }

        .face-blush {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        .thought-bubble {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 20px;
            color: #333;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            max-width: 200px;
        }

        .thought-bubble.show {
            transform: translateX(-50%) scale(1);
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-30px,0); }
            70% { transform: translate3d(0,-15px,0); }
            90% { transform: translate3d(0,-4px,0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 255, 136, 0.8); }
        }

        .bouncing { animation: bounce 2s infinite; }
        .shaking { animation: shake 0.8s infinite; }
        .glowing { animation: glow 2s infinite; }
    </style>
</head>
<body>
    <canvas class="neural-bg" id="neuralNetwork"></canvas>
    
    <div class="container">
        <div class="emotion-lab">
            <h1 class="title">NEURAL MONKEY</h1>
            <p class="subtitle">Advanced Emotional Intelligence Simulation</p>
            
            <div class="monkey-container">
                <div class="emotion-indicators">
                    <div class="emotion-dot" data-emotion="happy"></div>
                    <div class="emotion-dot" data-emotion="sad"></div>
                    <div class="emotion-dot" data-emotion="angry"></div>
                    <div class="emotion-dot" data-emotion="surprised"></div>
                    <div class="emotion-dot" data-emotion="sleepy"></div>
                </div>
                
                <div class="thought-bubble" id="thoughtBubble">I'm thinking...</div>
                
                <svg viewBox="0 0 64 64" id="monkeySvg" onclick="randomEmotion()">
                    <defs>
                        <radialGradient id="faceGradient" cx="50%" cy="40%" r="60%">
                            <stop offset="0%" style="stop-color:#D2691E"/>
                            <stop offset="100%" style="stop-color:#8B4513"/>
                        </radialGradient>
                        
                        <filter id="eyeGlow">
                            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                            <feMerge> 
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        
                        <filter id="dropShadow">
                            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                        </filter>
                    </defs>
                    
                    <!-- Main head structure -->
                    <path d="M55.087 24.853c-.977-6.743-4.993-11.406-11.711-14.07c1.145-.605 1.885-.908 1.885-.908c-3.236-1.14-6.045-1.804-8.477-2.106c1.279-.963 2.133-1.329 2.133-1.329c-19.752-2.786-29.492 8.2-30.104 18.428C4.943 25.547 2 28.91 2 32.969c0 4.017 2.883 7.354 6.696 8.08C9.132 50.464 19.396 58 31.999 58c12.605 0 22.869-7.536 23.305-16.951c3.812-.727 6.696-4.065 6.696-8.08c0-4.092-2.995-7.478-6.913-8.116M8.901 38.137c-2.31-.6-4.023-2.675-4.023-5.168c0-2.416 1.613-4.438 3.816-5.106c.049 2.162.618 4.229 1.614 6.134a14.31 14.31 0 0 0-1.407 4.14m35.647 1.787c1.328 1.656 2.106 3.59 2.106 5.665c0 6.082-6.562 11.01-14.655 11.01s-14.654-4.928-14.654-11.01c0-2.075.777-4.009 2.107-5.665c-4.557-2.758-7.474-6.98-7.474-11.719c0-16.934 20.021-6.146 20.021-6.146s20.022-10.787 20.022 6.146c0 4.738-2.917 8.961-7.473 11.719m10.551-1.787a14.363 14.363 0 0 0-1.406-4.141c.996-1.905 1.564-3.972 1.613-6.134c2.203.669 3.815 2.69 3.815 5.106c0 2.494-1.712 4.569-4.022 5.169" 
                          fill="url(#faceGradient)" filter="url(#dropShadow)"/>
                    
                    <!-- Face blush areas -->
                    <ellipse class="face-blush" id="leftBlush" cx="18" cy="35" rx="4" ry="3" fill="#FFB6C1" opacity="0"/>
                    <ellipse class="face-blush" id="rightBlush" cx="46" cy="35" rx="4" ry="3" fill="#FFB6C1" opacity="0"/>
                    
                    <!-- Eyebrows -->
                    <path class="eyebrow" id="leftEyebrow" d="M19 26 Q23.5 24 28 26" stroke="#654321" stroke-width="2" fill="none"/>
                    <path class="eyebrow" id="rightEyebrow" d="M36 26 Q40.5 24 45 26" stroke="#654321" stroke-width="2" fill="none"/>
                    
                    <!-- Eyes -->
                    <ellipse class="eye" id="leftEye" cx="23.318" cy="31.746" rx="3.5" ry="4.5" fill="#000000" filter="url(#eyeGlow)"/>
                    <ellipse class="eye" id="rightEye" cx="40.682" cy="31.746" rx="3.5" ry="4.5" fill="#000000" filter="url(#eyeGlow)"/>
                    
                    <!-- Eye pupils (for more complex expressions) -->
                    <circle id="leftPupil" cx="23.318" cy="31.746" r="1.5" fill="#FFFFFF" opacity="0.8"/>
                    <circle id="rightPupil" cx="40.682" cy="31.746" r="1.5" fill="#FFFFFF" opacity="0.8"/>
                    
                    <!-- Nostrils -->
                    <ellipse class="nostril" id="leftNostril" cx="29.853" cy="38.746" rx="1" ry="2" fill="#000000"/>
                    <ellipse class="nostril" id="rightNostril" cx="34.145" cy="38.746" rx="1" ry="2" fill="#000000"/>
                    
                    <!-- Mouth (main animation target) -->
                    <path id="mouth" class="mouth-path" 
                          d="M31.998 45.439c-4.689 0-9.459-1.271-9.845-.942c-1.425 1.214 2.944 6.939 9.845 6.977c6.9-.035 11.272-5.762 9.844-6.977c-.386-.328-5.154.943-9.844.942" 
                          fill="#000000"/>
                    
                    <!-- Additional mouth elements for complex expressions -->
                    <path id="tongue" d="" fill="#FF69B4" opacity="0"/>
                    <path id="teeth" d="" fill="#FFFFFF" opacity="0"/>
                </svg>
            </div>
            
            <div class="controls-grid">
                <button class="emotion-btn happy" onclick="setEmotion('happy')">😊 Happy</button>
                <button class="emotion-btn sad" onclick="setEmotion('sad')">😢 Sad</button>
                <button class="emotion-btn angry" onclick="setEmotion('angry')">😠 Angry</button>
                <button class="emotion-btn surprised" onclick="setEmotion('surprised')">😲 Surprised</button>
                <button class="emotion-btn sleepy" onclick="setEmotion('sleepy')">😴 Sleepy</button>
                <button class="emotion-btn confused" onclick="setEmotion('confused')">😕 Confused</button>
                <button class="emotion-btn excited" onclick="setEmotion('excited')">🤩 Excited</button>
                <button class="emotion-btn neutral" onclick="setEmotion('neutral')">😐 Neutral</button>
            </div>
            
            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Current Emotion</div>
                    <div class="stat-value" id="currentEmotion">Neutral</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="emotionIntensity" style="width: 50%"></div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Interactions</div>
                    <div class="stat-value" id="interactionCount">0</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="interactionProgress" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Happiness Level</div>
                    <div class="stat-value" id="happinessLevel">50%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="happinessProgress" style="width: 50%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MonkeyEmotionEngine {
            constructor() {
                this.currentEmotion = 'neutral';
                this.emotionIntensity = 50;
                this.interactionCount = 0;
                this.happinessLevel = 50;
                this.isAnimating = false;
                
                this.emotions = {
                    neutral: {
                        mouth: "M31.998 45.439c-4.689 0-9.459-1.271-9.845-.942c-1.425 1.214 2.944 6.939 9.845 6.977c6.9-.035 11.272-5.762 9.844-6.977c-.386-.328-5.154.943-9.844.942",
                        leftEyebrow: "M19 26 Q23.5 24 28 26",
                        rightEyebrow: "M36 26 Q40.5 24 45 26",
                        leftEye: { rx: 3.5, ry: 4.5 },
                        rightEye: { rx: 3.5, ry: 4.5 },
                        blush: 0,
                        thought: "I'm feeling neutral...",
                        intensity: 50
                    },
                    happy: {
                        mouth: "M24 46 Q32 42 40 46 Q32 50 24 46",
                        leftEyebrow: "M19 25 Q23.5 23 28 25",
                        rightEyebrow: "M36 25 Q40.5 23 45 25",
                        leftEye: { rx: 3, ry: 3.5 },
                        rightEye: { rx: 3, ry: 3.5 },
                        blush: 0.6,
                        thought: "Life is wonderful! 🌈",
                        intensity: 85
                    },
                    sad: {
                        mouth: "M24 48 Q32 52 40 48",
                        leftEyebrow: "M19 28 Q23.5 30 28 28",
                        rightEyebrow: "M36 28 Q40.5 30 45 28",
                        leftEye: { rx: 3.2, ry: 5 },
                        rightEye: { rx: 3.2, ry: 5 },
                        blush: 0,
                        thought: "Feeling a bit down... 😔",
                        intensity: 75
                    },
                    angry: {
                        mouth: "M26 47 L38 47 Q32 51 26 47",
                        leftEyebrow: "M19 28 Q23.5 26 28 28",
                        rightEyebrow: "M36 28 Q40.5 26 45 28",
                        leftEye: { rx: 3, ry: 4 },
                        rightEye: { rx: 3, ry: 4 },
                        blush: 0.4,
                        thought: "Grrrr! I'm furious! 😤",
                        intensity: 90
                    },
                    surprised: {
                        mouth: "M30 45 Q32 47 34 45 Q32 49 30 45",
                        leftEyebrow: "M19 22 Q23.5 20 28 22",
                        rightEyebrow: "M36 22 Q40.5 20 45 22",
                        leftEye: { rx: 4.5, ry: 5.5 },
                        rightEye: { rx: 4.5, ry: 5.5 },
                        blush: 0.3,
                        thought: "Whoa! Did not see that coming! 😱",
                        intensity: 80
                    },
                    sleepy: {
                        mouth: "M28 46 Q32 48 36 46",
                        leftEyebrow: "M19 27 Q23.5 25 28 27",
                        rightEyebrow: "M36 27 Q40.5 25 45 27",
                        leftEye: { rx: 3.5, ry: 2 },
                        rightEye: { rx: 3.5, ry: 2 },
                        blush: 0,
                        thought: "So sleepy... need coffee... ☕",
                        intensity: 40
                    },
                    confused: {
                        mouth: "M28 47 Q32 45 36 47 Q32 49 28 47",
                        leftEyebrow: "M19 25 Q23.5 27 28 25",
                        rightEyebrow: "M36 27 Q40.5 25 45 27",
                        leftEye: { rx: 3.2, ry: 4.2 },
                        rightEye: { rx: 3.8, ry: 4.8 },
                        blush: 0.2,
                        thought: "Huh? I don't get it... 🤔",
                        intensity: 60
                    },
                    excited: {
                        mouth: "M22 44 Q32 40 42 44 Q32 52 22 44",
                        leftEyebrow: "M19 24 Q23.5 22 28 24",
                        rightEyebrow: "M36 24 Q40.5 22 45 24",
                        leftEye: { rx: 4, ry: 5 },
                        rightEye: { rx: 4, ry: 5 },
                        blush: 0.8,
                        thought: "OMG! This is AMAZING! 🚀",
                        intensity: 95
                    }
                };
                
                this.initializeNeuralBackground();
                this.startEmotionalCycle();
            }
            
            setEmotion(emotion) {
                if (this.isAnimating) return;
                
                this.isAnimating = true;
                this.currentEmotion = emotion;
                this.interactionCount++;
                
                const config = this.emotions[emotion];
                const svg = document.getElementById('monkeySvg');
                
                // Update emotion indicators
                document.querySelectorAll('.emotion-dot').forEach(dot => {
                    dot.classList.remove('active');
                });
                const activeDot = document.querySelector(`[data-emotion="${emotion}"]`);
                if (activeDot) activeDot.classList.add('active');
                
                // Apply animations with staggered timing
                setTimeout(() => this.animateMouth(config.mouth), 0);
                setTimeout(() => this.animateEyebrows(config), 100);
                setTimeout(() => this.animateEyes(config), 200);
                setTimeout(() => this.animateBlush(config.blush), 300);
                setTimeout(() => this.showThought(config.thought), 400);
                
                // Add special effects
                this.addEmotionEffects(emotion, svg);
                
                // Update stats
                this.updateStats(config.intensity);
                
                // Calculate happiness based on positive emotions
                if (['happy', 'excited'].includes(emotion)) {
                    this.happinessLevel = Math.min(100, this.happinessLevel + 10);
                } else if (['sad', 'angry'].includes(emotion)) {
                    this.happinessLevel = Math.max(0, this.happinessLevel - 5);
                }
                
                setTimeout(() => {
                    this.isAnimating = false;
                }, 1500);
            }
            
            animateMouth(pathData) {
                document.getElementById('mouth').setAttribute('d', pathData);
            }
            
            animateEyebrows(config) {
                document.getElementById('leftEyebrow').setAttribute('d', config.leftEyebrow);
                document.getElementById('rightEyebrow').setAttribute('d', config.rightEyebrow);
            }
            
            animateEyes(config) {
                const leftEye = document.getElementById('leftEye');
                const rightEye = document.getElementById('rightEye');
                
                leftEye.setAttribute('rx', config.leftEye.rx);
                leftEye.setAttribute('ry', config.leftEye.ry);
                rightEye.setAttribute('rx', config.rightEye.rx);
                rightEye.setAttribute('ry', config.rightEye.ry);
            }
            
            animateBlush(opacity) {
                document.getElementById('leftBlush').style.opacity = opacity;
                document.getElementById('rightBlush').style.opacity = opacity;
            }
            
            showThought(text) {
                const bubble = document.getElementById('thoughtBubble');
                bubble.textContent = text;
                bubble.classList.add('show');
                
                setTimeout(() => {
                    bubble.classList.remove('show');
                }, 3000);
            }
            
            addEmotionEffects(emotion, svg) {
                // Remove existing effects
                svg.classList.remove('bouncing', 'shaking', 'glowing');
                
                switch(emotion) {
                    case 'excited':
                        svg.classList.add('bouncing');
                        break;
                    case 'angry':
                        svg.classList.add('shaking');
                        break;
                    case 'happy':
                        svg.classList.add('glowing');
                        break;
                }
            }
            
            updateStats(intensity) {
                document.getElementById('currentEmotion').textContent = 
                    this.currentEmotion.charAt(0).toUpperCase() + this.currentEmotion.slice(1);
                document.getElementById('emotionIntensity').style.width = intensity + '%';
                document.getElementById('interactionCount').textContent = this.interactionCount;
                document.getElementById('interactionProgress').style.width = 
                    Math.min(100, (this.interactionCount / 20) * 100) + '%';
                document.getElementById('happinessLevel').textContent = this.happinessLevel + '%';
                document.getElementById('happinessProgress').style.width = this.happinessLevel + '%';
            }
            
            randomEmotion() {
                const emotions = Object.keys(this.emotions);
                const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                this.setEmotion(randomEmotion);
            }
            
            startEmotionalCycle() {
                // Subtle emotional breathing effect
                setInterval(() => {
                    if (!this.isAnimating) {
                        const nostrils = document.querySelectorAll('.nostril');
                        nostrils.forEach(nostril => {
                            nostril.style.transform = 'scale(1.1)';
                            setTimeout(() => {
                                nostril.style.transform = 'scale(1)';
                            }, 500);
                        });
                    }
                }, 3000);
            }
            
            initializeNeuralBackground() {
                const canvas = document.getElementById('neuralNetwork');
                const ctx = canvas.getContext('2d');
                
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const nodes = [];
                const connections = [];
                const numNodes = 50;
                
                // Create neural network nodes
                for (let i = 0; i < numNodes; i++) {
                    nodes.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        size: Math.random() * 3 + 1
                    });
                }
                
                // Create connections between nearby nodes
                for (let i = 0; i < nodes.length; i++) {
                    for (let j = i + 1; j < nodes.length; j++) {
                        const dx = nodes[i].x - nodes[j].x;
                        const dy = nodes[i].y - nodes[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 150) {
                            connections.push({ i, j, opacity: 1 - distance / 150 });
                        }
                    }
                }
                
                function animateNetwork() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Update node positions
                    nodes.forEach(node => {
                        node.x += node.vx;
                        node.y += node.vy;
                        
                        if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
                        if (node.y < 0 || node.y > canvas.height) node.vy *= -1;
                    });
                    
                    // Draw connections
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                    ctx.lineWidth = 1;
                    connections.forEach(conn => {
                        const nodeA = nodes[conn.i];
                        const nodeB = nodes[conn.j];
                        const dx = nodeA.x - nodeB.x;
                        const dy = nodeA.y - nodeB.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 150) {
                            ctx.globalAlpha = (1 - distance / 150) * 0.3;
                            ctx.beginPath();
                            ctx.moveTo(nodeA.x, nodeA.y);
                            ctx.lineTo(nodeB.x, nodeB.y);
                            ctx.stroke();
                        }
                    });
                    
                    // Draw nodes
                    ctx.globalAlpha = 0.6;
                    nodes.forEach(node => {
                        ctx.fillStyle = '#00ff88';
                        ctx.beginPath();
                        ctx.arc(node.x, node.y, node.size, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    
                    requestAnimationFrame(animateNetwork);
                }
                
                animateNetwork();
                
                // Resize handler
                window.addEventListener('resize', () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                });
            }
        }
        
        // Initialize the emotion engine
        const monkeyEngine = new MonkeyEmotionEngine();
        
        // Global functions for button interactions
        function setEmotion(emotion) {
            monkeyEngine.setEmotion(emotion);
        }
        
        function randomEmotion() {
            monkeyEngine.randomEmotion();
        }
        
        // Advanced interaction features
        let emotionQueue = [];
        let isProcessingQueue = false;
        
        // Emotion memory system
        const emotionHistory = [];
        const maxHistoryLength = 10;
        
        function addToEmotionHistory(emotion) {
            emotionHistory.push({
                emotion: emotion,
                timestamp: Date.now()
            });
            
            if (emotionHistory.length > maxHistoryLength) {
                emotionHistory.shift();
            }
        }
        
        // Contextual emotion responses
        function getContextualResponse(emotion) {
            const recentEmotions = emotionHistory.slice(-3).map(h => h.emotion);
            
            if (recentEmotions.includes('sad') && emotion === 'happy') {
                return "Feeling better now! 😊";
            } else if (recentEmotions.includes('angry') && emotion === 'neutral') {
                return "Calming down... 😌";
            } else if (recentEmotions.filter(e => e === 'excited').length >= 2) {
                return "I'm on fire today! 🔥";
            }
            
            return monkeyEngine.emotions[emotion].thought;
        }
        
        // Voice synthesis (if supported)
        function speakEmotion(emotion) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance();
                utterance.text = `I'm feeling ${emotion}`;
                utterance.rate = 0.8;
                utterance.pitch = emotion === 'excited' ? 1.5 : emotion === 'sad' ? 0.7 : 1;
                speechSynthesis.speak(utterance);
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            const shortcuts = {
                'h': 'happy',
                's': 'sad',
                'a': 'angry',
                'e': 'excited',
                'n': 'neutral',
                'c': 'confused',
                'z': 'sleepy',
                'u': 'surprised'
            };
            
            if (shortcuts[e.key.toLowerCase()]) {
                setEmotion(shortcuts[e.key.toLowerCase()]);
            } else if (e.key === ' ') {
                e.preventDefault();
                randomEmotion();
            }
        });
        
        // Advanced mouse interactions
        let mouseHistory = [];
        document.getElementById('monkeySvg').addEventListener('mousemove', (e) => {
            mouseHistory.push({ x: e.clientX, y: e.clientY, time: Date.now() });
            
            // Keep only recent mouse positions
            mouseHistory = mouseHistory.filter(pos => Date.now() - pos.time < 1000);
            
            // Detect rapid mouse movement for excitement
            if (mouseHistory.length > 10) {
                const totalDistance = mouseHistory.reduce((acc, pos, i) => {
                    if (i === 0) return 0;
                    const prev = mouseHistory[i - 1];
                    return acc + Math.sqrt((pos.x - prev.x) ** 2 + (pos.y - prev.y) ** 2);
                }, 0);
                
                if (totalDistance > 500 && !monkeyEngine.isAnimating) {
                    setEmotion('excited');
                }
            }
        });
        
        // Touch/gesture support for mobile
        let touchStartTime = 0;
        let touchCount = 0;
        
        document.getElementById('monkeySvg').addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
            touchCount++;
        });
        
        document.getElementById('monkeySvg').addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;
            
            if (touchDuration > 1000) {
                setEmotion('sleepy'); // Long press = sleepy
            } else if (touchCount >= 3) {
                setEmotion('excited'); // Multiple taps = excited
                touchCount = 0;
            }
        });
        
        // Auto-reset touch count
        setInterval(() => {
            touchCount = 0;
        }, 2000);
        
        // Emotional intelligence learning
        const emotionPatterns = new Map();
        
        function analyzeEmotionPattern() {
            const recent = emotionHistory.slice(-5);
            if (recent.length >= 3) {
                const pattern = recent.map(h => h.emotion).join('-');
                emotionPatterns.set(pattern, (emotionPatterns.get(pattern) || 0) + 1);
                
                // Suggest emotions based on patterns
                const mostCommon = [...emotionPatterns.entries()]
                    .sort((a, b) => b[1] - a[1])[0];
                
                if (mostCommon && mostCommon[1] > 2) {
                    console.log(`Detected pattern: ${mostCommon[0]}`);
                }
            }
        }
        
        // Override setEmotion to include learning
        const originalSetEmotion = monkeyEngine.setEmotion.bind(monkeyEngine);
        monkeyEngine.setEmotion = function(emotion) {
            originalSetEmotion(emotion);
            addToEmotionHistory(emotion);
            analyzeEmotionPattern();
            
            // Update thought bubble with contextual response
            setTimeout(() => {
                const contextualThought = getContextualResponse(emotion);
                document.getElementById('thoughtBubble').textContent = contextualThought;
            }, 500);
        };
        
        // Particle system for special effects
        class ParticleSystem {
            constructor() {
                this.particles = [];
                this.canvas = document.createElement('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.style.position = 'absolute';
                this.canvas.style.top = '0';
                this.canvas.style.left = '0';
                this.canvas.style.pointerEvents = 'none';
                this.canvas.style.zIndex = '10';
                document.querySelector('.monkey-container').appendChild(this.canvas);
                
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.animate();
            }
            
            resize() {
                const container = document.querySelector('.monkey-container');
                this.canvas.width = container.offsetWidth;
                this.canvas.height = container.offsetHeight;
            }
            
            createParticle(x, y, color) {
                this.particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: Math.random() * -3 - 1,
                    life: 1,
                    decay: Math.random() * 0.02 + 0.01,
                    size: Math.random() * 4 + 2,
                    color: color
                });
            }
            
            update() {
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.1; // gravity
                    particle.life -= particle.decay;
                    
                    return particle.life > 0;
                });
            }
            
            render() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.particles.forEach(particle => {
                    this.ctx.globalAlpha = particle.life;
                    this.ctx.fillStyle = particle.color;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }
            
            animate() {
                this.update();
                this.render();
                requestAnimationFrame(() => this.animate());
            }
            
            burst(emotion) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                const colors = {
                    happy: '#FFD700',
                    excited: '#FF4500',
                    angry: '#FF0000',
                    surprised: '#FF69B4',
                    sad: '#4682B4'
                };
                
                const color = colors[emotion] || '#FFFFFF';
                
                for (let i = 0; i < 20; i++) {
                    this.createParticle(centerX, centerY, color);
                }
            }
        }
        
        const particles = new ParticleSystem();
        
        // Add particle effects to emotions
        const originalSetEmotionWithParticles = monkeyEngine.setEmotion;
        monkeyEngine.setEmotion = function(emotion) {
            originalSetEmotionWithParticles.call(this, emotion);
            
            if (['happy', 'excited', 'surprised'].includes(emotion)) {
                particles.burst(emotion);
            }
        };
        
        // Initialize with a welcome animation
        setTimeout(() => {
            setEmotion('happy');
            setTimeout(() => {
                document.getElementById('thoughtBubble').textContent = "Welcome! Try clicking me or use the buttons below! 🎉";
                document.getElementById('thoughtBubble').classList.add('show');
                
                setTimeout(() => {
                    document.getElementById('thoughtBubble').classList.remove('show');
                }, 4000);
            }, 1000);
        }, 2000);
        
        // Performance monitoring
        let frameCount = 0;
        let lastTime = performance.now();
        
        function monitorPerformance() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                console.log(`FPS: ${frameCount}`);
                frameCount = 0;
                lastTime = currentTime;
            }
            
            requestAnimationFrame(monitorPerformance);
        }
        
        monitorPerformance();
</script>

</body>
</html>
