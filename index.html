<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculus Animation</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f5f5f5;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    
    .chalkboard {
      width: 90%;
      max-width: 700px;
      height: 650px;
      background-color: #2a623d;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
      padding: 30px;
    }
    
    .chalk-text {
      color: rgba(255, 255, 255, 0.9);
      font-size: 26px;
      line-height: 1.6;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      opacity: 0;
      position: relative;
      margin: 40px 0;
      display: flex;
      align-items: center;
    }
    
    .chalk-text span {
      opacity: 0;
    }
    
    .step-number {
      display: inline-block;
      width: 36px;
      height: 36px;
      background-color: rgba(255,255,255,0.2);
      border-radius: 50%;
      text-align: center;
      line-height: 36px;
      margin-right: 15px;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .chalk-dust {
      position: absolute;
      width: 3px;
      height: 3px;
      background-color: rgba(255,255,255,0.7);
      border-radius: 50%;
      pointer-events: none;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    
    .btn {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 0 10px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .title {
      font-size: 32px;
      text-align: center;
      margin-bottom: 45px;
    }

    .subtitle {
      font-size: 24px;
      text-align: center;
      margin-top: -20px;
      margin-bottom: 45px;
      font-style: italic;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }
    
    .highlight {
      position: relative;
      display: inline-block;
    }
    
    .highlight::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: -2px;
      width: 100%;
      height: 8px;
      background-color: rgba(255, 255, 100, 0.4);
      border-radius: 4px;
      z-index: -1;
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.5s ease;
    }

    /* For math expressions */
    .fraction {
      display: inline-block;
      vertical-align: middle;
      text-align: center;
      margin: 0 3px;
    }
    .fraction .numerator {
      border-bottom: 2px solid white;
      padding: 0 3px;
    }
    .fraction .denominator {
      padding: 0 3px;
    }
    .superscript {
      position: relative;
      font-size: 0.7em;
      top: -0.5em;
    }
    .rule-box {
      border: 2px dashed rgba(255, 255, 255, 0.6);
      padding: 5px 10px;
      border-radius: 8px;
      display: inline-block;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="chalkboard">
    <div class="chalk-text title">
      <span>Find the Derivative</span>
    </div>
    
    <div class="chalk-text subtitle">
      <span>f(x) = x³ - 4x² + 6x - 8</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">1</span>
      <span>To find f'(x), we'll use the <strong class="highlight">power rule</strong>:</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">R</span>
      <span class="rule-box">If f(x) = x<span class="superscript">n</span>, then f'(x) = n·x<span class="superscript">n-1</span></span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">2</span>
      <span>Apply the power rule to each term:</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">3</span>
      <span>For x³: f'(x) = 3·x<span class="superscript">3-1</span> = 3x²</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">4</span>
      <span>For -4x²: f'(x) = -4·2·x<span class="superscript">2-1</span> = -8x</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">5</span>
      <span>For 6x: f'(x) = 6·1·x<span class="superscript">1-1</span> = 6·x⁰ = 6</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">6</span>
      <span>For -8: f'(x) = 0 (constants disappear)</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">7</span>
      <span>Combining all terms:</span>
    </div>
    
    <div class="chalk-text">
      <span class="step-number">✓</span>
      <span>f'(x) = 3x² - 8x + 6</span>
    </div>
  </div>
  
  <div class="controls">
    <button class="btn" id="replay">Replay</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const lines = document.querySelectorAll('.chalk-text');
      let currentLine = 0;
      let dustInterval;
      
      function animateText(element) {
        const spans = element.querySelectorAll('span');
        let index = 0;
        
        element.style.opacity = 1;
        
        function revealNextSpan() {
          if (index < spans.length) {
            const span = spans[index];
            span.style.opacity = 1;
            
            if (span.classList.contains('highlight')) {
              setTimeout(() => {
                const highlight = span.querySelector('::after');
                if (highlight) {
                  highlight.style.transform = 'scaleX(1)';
                }
              }, 300);
            }
            
            // Add shake animation to the current span
            span.style.animation = 'shake 0.3s ease';
            setTimeout(() => {
              span.style.animation = '';
            }, 300);
            
            index++;
            setTimeout(revealNextSpan, 300);
          } else {
            // Move to next line after a longer pause (3 seconds) to allow reading time
            setTimeout(() => {
              if (currentLine < lines.length - 1) {
                currentLine++;
                animateText(lines[currentLine]);
              } else {
                // All lines finished
                clearInterval(dustInterval);
                highlightAnswers();
              }
            }, 3000);
          }
        }
        
        revealNextSpan();
      }
      
      function createChalkDust() {
        // Create chalk dust at a slower rate to match slower writing
        if (Math.random() > 0.5) return; // Only create dust 50% of the time
        
        const dust = document.createElement('div');
        dust.className = 'chalk-dust';
        
        const chalkboard = document.querySelector('.chalkboard');
        const activeLine = lines[currentLine];
        
        if (activeLine) {
          const rect = activeLine.getBoundingClientRect();
          const boardRect = chalkboard.getBoundingClientRect();
          
          // Position dust relative to the current line
          const x = Math.random() * rect.width + (rect.left - boardRect.left);
          const y = Math.random() * 10 + (rect.top - boardRect.top + rect.height / 2);
          
          dust.style.left = `${x}px`;
          dust.style.top = `${y}px`;
          
          chalkboard.appendChild(dust);
          
          // Animate dust falling
          let opacity = 0.7;
          let posY = y;
          
          const fallInterval = setInterval(() => {
            opacity -= 0.01;
            posY += 0.5;
            
            dust.style.opacity = opacity;
            dust.style.top = `${posY}px`;
            
            if (opacity <= 0) {
              clearInterval(fallInterval);
              dust.remove();
            }
          }, 20);
        }
      }
      
      function highlightAnswers() {
        // Highlight the final answer with a special effect
        const finalAnswer = lines[lines.length - 1];
        const highlights = document.querySelectorAll('.highlight');
        
        highlights.forEach(el => {
          const highlight = el.querySelector('::after');
          if (highlight) {
            highlight.style.transform = 'scaleX(1)';
          }
        });
        
        finalAnswer.style.transform = 'scale(1.05)';
        finalAnswer.style.textShadow = '0 0 10px rgba(255,255,100,0.8)';
      }
      
      function startAnimation() {
        // Reset everything
        lines.forEach(line => {
          line.style.opacity = 0;
          const spans = line.querySelectorAll('span');
          spans.forEach(span => span.style.opacity = 0);
          line.style.transform = '';
          line.style.textShadow = '';
        });
        
        // Clear any existing dust
        document.querySelectorAll('.chalk-dust').forEach(el => el.remove());
        
        // Reset line counter
        currentLine = 0;
        
        // Start chalk dust effect
        dustInterval = setInterval(createChalkDust, 100);
        
        // Start animation
        animateText(lines[currentLine]);
      }
      
      // Start on page load
      startAnimation();
      
      // Replay button
      document.getElementById('replay').addEventListener('click', startAnimation);
    });
  </script>
</body>
</html>
